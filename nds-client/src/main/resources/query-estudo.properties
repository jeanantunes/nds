queryProdutoEdicaoEstudo=SELECT pe.ID, pe.PRODUTO_ID, pe.NUMERO_EDICAO, pe.PACOTE_PADRAO, p.CODIGO, l.DATA_LCTO_DISTRIBUIDOR, l.ID LANCAMENTO_ID, p.TIPO_SEGMENTO_PRODUTO_ID FROM produto_edicao pe JOIN produto p ON pe.PRODUTO_ID = p.ID JOIN lancamento l ON l.PRODUTO_EDICAO_ID = pe.ID AND L.STATUS = 'BALANCEADO' WHERE p.CODIGO = :CODIGO_PRODUTO AND pe.NUMERO_EDICAO = :NUMERO_EDICAO ORDER BY NUMERO_EDICAO DESC LIMIT 1
queryEdicoesRecebidas=SELECT P.NOME, PE.NUMERO_EDICAO, EPC.QTDE_RECEBIDA, EPC.QTDE_DEVOLVIDA, PE.PARCIAL, PE.PESO, PE.ID as pedId, TSP.ID AS TIPO_SEGMENTO_PRODUTO_ID, TSP.DESCRICAO AS TIPO_SEGMENTO_PRODUTO_DESC, (CASE WHEN EXISTS(SELECT '.' FROM TIPO_PRODUTO TP WHERE TP.ID = P.TIPO_PRODUTO_ID AND TP.GRUPO_PRODUTO = 'COLECIONAVEL') THEN 1 ELSE 0 END) IS_COLECAO FROM ESTOQUE_PRODUTO_COTA EPC JOIN PRODUTO_EDICAO PE ON PE.ID = EPC.PRODUTO_EDICAO_ID JOIN PRODUTO P ON P.ID = PE.PRODUTO_ID JOIN TIPO_SEGMENTO_PRODUTO TSP ON TSP.ID = P.TIPO_SEGMENTO_PRODUTO_ID WHERE EPC.COTA_ID = :COTA_ID
queryQtdeVezesReenviadas=SELECT count(EPC.id) FROM ESTOQUE_PRODUTO_COTA EPC JOIN PRODUTO_EDICAO PE ON PE.ID = EPC.PRODUTO_EDICAO_ID WHERE EPC.COTA_ID = :COTA_ID AND PE.ID = :PRODUTO_EDICAO_ID and PE.parcial = 1

queryEdicoesLancamentos=SELECT l.ID, l.PRODUTO_EDICAO_ID, l.STATUS, l.DATA_LCTO_PREVISTA, l.DATA_LCTO_DISTRIBUIDOR, tp.GRUPO_PRODUTO, l.TIPO_LANCAMENTO, pe.NUMERO_EDICAO, p.CODIGO, plp.NUMERO_PERIODO, plp.TIPO, pe.PARCIAL, p.id PRODUTO_ID FROM lancamento l LEFT JOIN produto_edicao pe ON pe.ID = l.PRODUTO_EDICAO_ID LEFT JOIN produto p ON p.ID = pe.PRODUTO_ID LEFT JOIN tipo_produto tp ON tp.ID = p.TIPO_PRODUTO_ID LEFT JOIN periodo_lancamento_parcial plp ON plp.LANCAMENTO_ID = l.ID WHERE pe.PRODUTO_ID = (SELECT ID FROM produto WHERE CODIGO = :CODIGO_PRODUTO) AND L.STATUS IN ('EXPEDIDO', 'EM_BALANCEAMENTO_RECOLHIMENTO', 'BALANCEADO_RECOLHIMENTO', 'EXCLUIDO_RECOLHIMENTO', 'FECHADO', 'RECOLHIDO') ORDER BY L.DATA_LCTO_DISTRIBUIDOR DESC, pe.NUMERO_EDICAO DESC, plp.NUMERO_PERIODO DESC LIMIT 50
queryLancamentosAnosAnterioresMesmoMes=SELECT l.ID, l.PRODUTO_EDICAO_ID, l.STATUS, l.DATA_LCTO_PREVISTA, l.DATA_LCTO_DISTRIBUIDOR, tp.GRUPO_PRODUTO, l.TIPO_LANCAMENTO, pe.NUMERO_EDICAO, p.CODIGO, plp.NUMERO_PERIODO, plp.TIPO FROM lancamento l LEFT JOIN produto_edicao pe ON pe.ID = l.PRODUTO_EDICAO_ID LEFT JOIN produto p ON p.ID = pe.PRODUTO_ID LEFT JOIN tipo_produto tp ON tp.ID = p.TIPO_PRODUTO_ID LEFT JOIN periodo_lancamento_parcial plp ON plp.LANCAMENTO_ID = l.ID WHERE pe.PRODUTO_ID = (SELECT ID FROM produto WHERE CODIGO = :CODIGO_PRODUTO) AND (EXTRACT(YEAR_MONTH FROM l.DATA_LCTO_DISTRIBUIDOR) = EXTRACT(YEAR_MONTH FROM ADDDATE(:DATA_LANCAMENTO, INTERVAL -1 YEAR)) OR EXTRACT(YEAR_MONTH FROM l.DATA_LCTO_DISTRIBUIDOR) = EXTRACT(YEAR_MONTH FROM ADDDATE(:DATA_LANCAMENTO, INTERVAL -2 YEAR))) ORDER BY pe.NUMERO_EDICAO DESC, plp.NUMERO_PERIODO DESC LIMIT 2
queryLancamentosAnosAnterioresVeraneio=SELECT l.ID, l.PRODUTO_EDICAO_ID, l.STATUS, l.DATA_LCTO_PREVISTA, l.DATA_LCTO_DISTRIBUIDOR, tp.GRUPO_PRODUTO, l.TIPO_LANCAMENTO, pe.NUMERO_EDICAO, p.CODIGO, plp.NUMERO_PERIODO, plp.TIPO FROM lancamento l LEFT JOIN produto_edicao pe ON pe.ID = l.PRODUTO_EDICAO_ID LEFT JOIN produto p ON p.ID = pe.PRODUTO_ID LEFT JOIN tipo_produto tp ON tp.ID = p.TIPO_PRODUTO_ID LEFT JOIN periodo_lancamento_parcial plp ON plp.LANCAMENTO_ID = l.ID WHERE pe.PRODUTO_ID = (SELECT ID FROM produto WHERE CODIGO = :CODIGO_PRODUTO) AND (l.DATA_LCTO_DISTRIBUIDOR BETWEEN :DATA0 AND :DATA1 OR l.DATA_LCTO_DISTRIBUIDOR BETWEEN :DATA2 AND :DATA3) ORDER BY pe.NUMERO_EDICAO DESC, plp.NUMERO_PERIODO DESC LIMIT 2

queryHistoricoCotaParcial=select t.cota_id, t.reparte, t.reparte - t.encalhe venda from (select mec.cota_id, sum(case when tm.grupo_movimento_estoque = 'RECEBIMENTO_REPARTE' then mec.qtde else 0 end) reparte, sum(case when tm.grupo_movimento_estoque = 'ENVIO_ENCALHE' then mec.qtde else 0 end) encalhe from movimento_estoque_cota mec join tipo_movimento tm on tm.id = mec.tipo_movimento_id join lancamento l on l.id = mec.lancamento_id join periodo_lancamento_parcial plp on plp.lancamento_id = l.id and plp.numero_periodo = 1 where mec.produto_edicao_id = :produto_edicao_id order by mec.cota_id) t
queryHistoricoCota=select epc.cota_id, epc.qtde_recebida - epc.qtde_devolvida venda, epc.qtde_recebida reparte from estoque_produto_cota epc where epc.produto_edicao_id = :produto_edicao_id order by epc.cota_id
queryCotas=select distinct c.id cota_id, c.numero_cota, c.recebe_complementar, c.situacao_cadastro, tp.grupo_produto, ar.ajuste_aplicado, ar.forma_ajuste, mcp.reparte_max, mcp.reparte_min, (case when mcp.id is not null then 1 else 0 end) mix, c.tipo_distribuicao_cota, fr.qtde_exemplares reparte_fixado, (select count(*) from pdv where cota_id = c.id) qtde_pdvs, rcr.regiao_id, cb.id cota_base_id, rs.qtde qtde_ranking, (case when snr.id is not null then 1 else 0 end) cota_nao_recebe_segmento, (case when ep.id is not null then 1 else 0 end) cota_excecao_segmento, (case when cnr.id is not null then 1 else 0 end) cota_nao_recebe_classificacao from cota c left join ranking_segmento rs on rs.cota_id = c.id and rs.data_geracao_rank = (select max(data_geracao_rank) from ranking_segmento) and rs.tipo_segmento_produto_id = :tipo_segmento_produto_id join produto p on p.id = :produto_id join produto_edicao pe on pe.produto_id = p.id and pe.numero_edicao = :numero_edicao join tipo_produto tp on tp.id = p.tipo_produto_id left join registro_cota_regiao rcr ON rcr.cota_id = c.id left join mix_cota_produto mcp ON mcp.id_cota = c.id and mcp.id_produto = p.id left join fixacao_reparte fr ON fr.id_cota = c.id and fr.id_produto = p.id and ((pe.numero_edicao between fr.ed_inicial and fr.ed_final) or (coalesce(fr.ed_inicial, 0) = 0 and coalesce(fr.ed_final, 0) = 0 and coalesce(fr.ed_atendidas, 0) < coalesce(fr.qtde_edicoes, 0))) left join cota_base cb ON cb.cota_id = c.id left join ajuste_reparte ar on ar.cota_id = c.id and (ar.tipo_segmento_ajuste_id = p.tipo_segmento_produto_id or ar.tipo_segmento_ajuste_id is null) left join segmento_nao_recebido snr on snr.cota_id = c.id and snr.tipo_segmento_produto_id = p.tipo_segmento_produto_id left join excecao_produto_cota ep on ep.cota_id = c.id and ep.produto_id = p.id and ep.tipo_excecao = 'SEGMENTO' left join classificacao_nao_recebida cnr on cnr.cota_id = c.id and cnr.tipo_classificacao_produto_id = p.tipo_classificacao_produto_id where c.situacao_cadastro in ('ATIVO', 'SUSPENSO') order by c.id

queryCotasDesenglobadas=select COTA_ID_DESENGLOBADA, COTA_ID_ENGLOBADA, PORCENTAGEM_COTA_ENGLOBADA, DATA_ALTERACAO from desenglobacao
queryCotaWithEstoqueProdutoCota=SELECT C.*, P.NOME FROM COTA C INNER JOIN PESSOA P ON (P.ID = C.PESSOA_ID) WHERE EXISTS (SELECT EPC.* FROM ESTOQUE_PRODUTO_COTA EPC WHERE EPC.COTA_ID = C.ID) ORDER BY C.ID
queryCotaEquivalente=SELECT CB.INDICE_AJUSTE, C.* FROM COTA_BASE_COTA CBC JOIN COTA_BASE CB ON (CB.ID = CBC.COTA_BASE_ID) JOIN COTA C ON (C.ID = CBC.COTA_ID) JOIN PESSOA P ON (P.ID = C.PESSOA_ID) WHERE CB.COTA_ID = :COTA_ID AND :DATA BETWEEN CB.DATA_INICIO AND CB.DATA_FIM
queryCotaRecebeuEdicaoAberta=select e.cota_id from estoque_produto_cota e join produto_edicao pe on pe.id = e.produto_edicao_id join produto p on p.id = pe.produto_id and p.codigo = :codigo_produto where e.cota_id in (:ids_cota) and pe.numero_edicao in (:numeros_edicao)
queryProdutoEdicaoPorCota=select distinct c.id cota_id, c.numero_cota, c.recebe_complementar, c.situacao_cadastro, p2.id produto_id, pe2.id produto_edicao_id, pe2.numero_edicao, p2.codigo, l.id lancamento_id, l.status, l.tipo_lancamento, tp.grupo_produto, l.data_lcto_distribuidor, epc.qtde_recebida, (epc.qtde_recebida - epc.qtde_devolvida) AS qtde_venda, ar.ajuste_aplicado, ar.forma_ajuste, mcp.reparte_max, mcp.reparte_min, (case when mcp.reparte_max is not null or mcp.reparte_min is not null then 1 else 0 end) mix, fr.qtde_exemplares, (select count(*) from pdv where cota_id = c.id) qtde_pdvs, rcr.regiao_id, cb.id cota_base_id from cota c left join estoque_produto_cota epc ON epc.cota_id = c.id and epc.produto_edicao_id in (:IDS_PRODUTOS) join produto_edicao pe2 on pe2.id = epc.produto_edicao_id join produto p2 on p2.id = pe2.produto_id join produto p ON p.id = :ID_PRODUTO join produto_edicao pe ON pe.produto_id = p.id and pe.numero_edicao = :NUMERO_EDICAO join lancamento l ON l.produto_edicao_id = pe.id join tipo_produto tp ON tp.id = p.tipo_produto_id left join ranking_segmento rs ON rs.tipo_segmento_produto_id = p.tipo_segmento_produto_id and rs.data_geracao_rank = (select max(data_geracao_rank) from ranking_segmento) left join registro_cota_regiao rcr ON rcr.cota_id = c.id left join ajuste_reparte ar ON ar.cota_id = c.id and (ar.id = :TIPO_SEGMENTO or ar.id is null) left join mix_cota_produto mcp ON mcp.id_cota = c.id and mcp.id_produto = p.id left join fixacao_reparte fr ON fr.id_cota = c.id and fr.id_produto = p.id and ((pe.numero_edicao between fr.ed_inicial and fr.ed_final) or (coalesce(fr.ed_inicial, 0) = 0 and coalesce(fr.ed_final, 0) = 0 and coalesce(fr.ed_atendidas, 0) < coalesce(fr.qtde_edicoes, 0))) left join cota_base cb ON cb.cota_id = c.id where c.situacao_cadastro in ('ATIVO' , 'SUSPENSO') order by c.id , l.data_lcto_distribuidor desc , pe.numero_edicao desc , rs.qtde desc

queryReparteJuramentadoAFaturar=SELECT SUM(QTDE) FROM MOVIMENTO_ESTOQUE_COTA MEC WHERE TIPO_MOVIMENTO_ID = :TIPO_MOVIMENTO_ID AND MEC.COTA_ID = :COTA_ID AND MEC.PRODUTO_EDICAO_ID = :PRODUTO_EDICAO_ID ORDER BY ID
queryCotasOrdenadasMaiorMenor=SELECT DISTINCT COTA_ID FROM RANKING_SEGMENTO RS WHERE RS.PRODUTO_EDICAO_ID = :PRODUTO_EDICAO_ID AND RANKING_SEGMENTO_GERADOS_ID = (SELECT MAX(ID) FROM RANKING_SEGMENTO_GERADOS) AND COTA_ID IN (:IDS_COTA)

insertEstudo=INSERT INTO estudo (produto_edicao_id, lancamento_id, liberado, reparte_distribuir, sobra, distribuicao_por_multiplos, pacote_padrao, data_cadastro, data_lancamento, qtde_reparte, status, usuario_id) VALUES (:produtoEdicaoEstudo.id, :produtoEdicaoEstudo.idLancamento, false, :reparteDistribuirInicial - :reparteDistribuir, :reparteDistribuir, :distribuicaoPorMultiplos, :pacotePadrao, :dataCadastro, :produtoEdicaoEstudo.dataLancamento, :reparteDistribuirInicial, :statusEstudo, :usuarioId)
insertEstudoCotas=INSERT INTO estudo_cota (cota_id, estudo_id, qtde_prevista, qtde_efetiva, classificacao, reparte, venda_media, venda_media_nominal, reparte_juramentado_a_faturar, quantidade_pdvs, reparte_minimo, reparte_maximo, venda_media_mais_n, indice_correcao_tendencia, indice_venda_crescente, percentual_encalhe_maximo, mix, cota_nova) VALUES (:id, :idEstudo, :reparteCalculado, :reparteCalculado, :classificacao.codigo, :reparteCalculado, :vendaMedia, :vendaMediaNominal, :reparteJuramentadoAFaturar, :quantidadePDVs, :reparteMinimo, :reparteMaximo, :vendaMediaMaisN, :indiceCorrecaoTendencia, :indiceVendaCrescente, :percentualEncalheMaximo, :mix, :nova)
insertProdutoEdicao=INSERT INTO estudo_produto_edicao (estudo_id, cota_id, produto_edicao_id, reparte, venda, indice_correcao, venda_corrigida) VALUES (:idEstudo, :idCota, :id, :reparte, :venda, :indiceCorrecao, :vendaCorrigida)
insertProdutoEdicaoBase=INSERT INTO estudo_produto_edicao_base (estudo_id, produto_edicao_id, colecao, parcial, edicao_aberta, peso) VALUES (:idEstudo, :id, :colecao, :parcial, :edicaoAberta, :indicePeso)

queryParametrosDistribuidor=SELECT COMPLEMENTAR_AUTOMATICO, GERACAO_AUTOMATICA_ESTUDO, PERCENTUAL_MAXIMO_FIXACAO, PRACA_VERANEIO, VENDA_MEDIA_MAIS FROM distribuidor_grid_distribuicao
queryPercentuaisExcedentes=SELECT EFICIENCIA, PDV, VENDA FROM distribuidor_percentual_excedente;
